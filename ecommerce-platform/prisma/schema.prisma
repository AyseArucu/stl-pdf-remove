generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String           @id @default(cuid())
  email         String           @unique
  name          String?
  phone         String?
  image         String?
  password      String?
  role          String           @default("CUSTOMER")
  isActive      Boolean          @default(true)
  emailVerified DateTime?
  roleId        String?
  blogComments  BlogComment[]
  blogPosts     BlogPost[]
  cart          Cart?
  favorites     Favorite[]
  orders        Order[]
  qrCodes       QrCode[]
  questions     Question[]
  reviews       Review[]
  stlFavorites  StlFavorite[]
  userRole      Role?            @relation(fields: [roleId], references: [id])
  permissions   UserPermission[]
}

model Role {
  id          String           @id @default(cuid())
  name        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
  users       User[]
}

model Permission {
  id          String           @id @default(cuid())
  key         String           @unique
  description String?
  module      String
  roles       RolePermission[]
  users       UserPermission[]
}

model RolePermission {
  id           String     @id @default(cuid())
  roleId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
}

model UserPermission {
  id           String     @id @default(cuid())
  userId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
}

model AuditLog {
  id          String   @id @default(cuid())
  action      String
  performedBy String
  targetUser  String?
  details     String?
  createdAt   DateTime @default(now())
}

model EmailChangeToken {
  id        String   @id @default(cuid())
  userId    String
  newEmail  String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

model Category {
  id       String     @id @default(cuid())
  name     String
  parentId String?
  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]
}

model Product {
  id            String           @id @default(cuid())
  name          String
  description   String
  price         Float
  stock         Int
  imageUrl      String
  categoryId    String
  salePrice     Float?
  color         String?
  freeShipping  Boolean          @default(false)
  rating        Float            @default(0)
  isActive      Boolean          @default(true)
  favoriteCount Int              @default(0)
  viewCount     Int              @default(0)
  createdAt     DateTime         @default(now())
  cartItems     CartItem[]
  favorites     Favorite[]
  orderItems    OrderItem[]
  category      Category         @relation(fields: [categoryId], references: [id])
  features      ProductFeature[]
  media         ProductMedia[]
  options       ProductOption[]
  questions     Question[]
  reviews       Review[]
  collections   Collection[]     @relation("CollectionProducts")
}

model ProductMedia {
  id        String  @id @default(cuid())
  productId String
  type      String
  url       String
  thumbnail String?
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProductOption {
  id        String  @id @default(cuid())
  productId String
  name      String
  price     Float
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProductFeature {
  id          String  @id @default(cuid())
  productId   String
  title       String
  description String
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Order {
  id            String      @id @default(cuid())
  customerName  String
  customerEmail String
  address       String
  total         Float
  discountTotal Float?
  status        String
  paymentMethod String
  paymentStatus String
  date          DateTime    @default(now())
  userId        String?
  user          User?       @relation(fields: [userId], references: [id])
  items         OrderItem[]
}

model OrderItem {
  id          String    @id @default(cuid())
  orderId     String
  productId   String?
  stlModelId  String?
  productName String
  quantity    Int
  price       Float
  stlModel    StlModel? @relation(fields: [stlModelId], references: [id])
  product     Product?  @relation(fields: [productId], references: [id])
  order       Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Review {
  id        String   @id @default(cuid())
  productId String
  userId    String
  userName  String
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
}

model Question {
  id        String   @id @default(cuid())
  productId String
  userId    String?
  userName  String
  question  String
  answer    String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
}

model Collection {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  description String?
  imageUrl    String?
  isActive    Boolean   @default(true)
  products    Product[] @relation("CollectionProducts")
}

model Discount {
  id         String   @id @default(cuid())
  name       String
  percentage Float
  isActive   Boolean  @default(true)
  startDate  DateTime
  endDate    DateTime
}

model ContactMessage {
  id      String   @id @default(cuid())
  name    String
  email   String
  subject String
  message String
  date    DateTime @default(now())
}

model ServiceRequest {
  id               String   @id @default(cuid())
  name             String
  email            String
  phone            String
  siteType         String
  pageCount        String
  specialRequests  String?
  budget           String?
  status           String   @default("NEW")
  adminNotes       String?
  offerPrice       Float?
  offerDescription String?
  paymentToken     String?
  createdAt        DateTime @default(now())
}

model FAQItem {
  id       String @id @default(cuid())
  question String
  answer   String
}

model ContactSettings {
  id        String  @id @default(cuid())
  address   String
  mapUrl    String
  phone     String?
  email     String?
  instagram String?
  twitter   String?
  facebook  String?
  linkedin  String?
  youtube   String?
}

model HeroSlide {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  description String?
  imageUrl    String
  buttonText  String   @default("Koleksiyonu Ke≈üfet")
  buttonLink  String   @default("/collections")
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  bgImageUrl  String?
}

model ServicePageContent {
  id              String @id @default(cuid())
  heroTitle       String
  heroDescription String
  benefits        String
  whyUsText       String
  stats           String
  packages        String
  faqs            String
  whatsappNumber  String
  whatsappMessage String
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model Cart {
  id        String     @id @default(cuid())
  userId    String?    @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]
}

model CartItem {
  id         String    @id @default(cuid())
  cartId     String
  productId  String?
  stlModelId String?
  quantity   Int
  price      Float
  createdAt  DateTime  @default(now())
  stlModel   StlModel? @relation(fields: [stlModelId], references: [id], onDelete: Cascade)
  product    Product?  @relation(fields: [productId], references: [id], onDelete: Cascade)
  cart       Cart      @relation(fields: [cartId], references: [id], onDelete: Cascade)
}

model StlCategory {
  id       String     @id @default(cuid())
  name     String
  slug     String?    @unique
  isActive Boolean    @default(true)
  models   StlModel[]
}

model StlModel {
  id            String        @id @default(cuid())
  name          String
  description   String
  fileUrl       String
  imageUrl      String
  price         Float         @default(0)
  isFree        Boolean       @default(false)
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  categoryId    String?
  viewCount     Int           @default(0)
  downloadCount Int           @default(0)
  favoriteCount Int           @default(0)
  cartItems     CartItem[]
  orderItems    OrderItem[]
  favorites     StlFavorite[]
  category      StlCategory?  @relation(fields: [categoryId], references: [id])
  tags          StlTag[]      @relation("StlModelTags")
}

model StlFavorite {
  id         String   @id @default(cuid())
  userId     String
  stlModelId String
  createdAt  DateTime @default(now())
  stlModel   StlModel @relation(fields: [stlModelId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, stlModelId])
}

model StlTag {
  id     String     @id @default(cuid())
  name   String     @unique
  models StlModel[] @relation("StlModelTags")
}

model ShippingSettings {
  id                    String  @id @default(cuid())
  shippingCost          Float   @default(0)
  freeShippingThreshold Float?
  isActive              Boolean @default(true)
}

model BlogPost {
  id         String        @id @default(cuid())
  title      String
  slug       String        @unique
  coverImage String
  excerpt    String
  content    String
  category   String
  published  Boolean       @default(true)
  viewCount  Int           @default(0)
  author     String?
  authorId   String?
  images     String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  comments   BlogComment[]
  authorUser User?         @relation(fields: [authorId], references: [id])
}

model BlogComment {
  id            String        @id @default(cuid())
  content       String
  postId        String
  userId        String
  authorName    String?
  authorSurname String?
  createdAt     DateTime      @default(now())
  parentId      String?
  parent        BlogComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies       BlogComment[] @relation("CommentReplies")
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  post          BlogPost      @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model QrCode {
  id        String   @id @default(cuid())
  type      String   @default("url")
  targetUrl String?
  data      String?
  name      String?
  password  String?
  viewCount Int      @default(0)
  design    String?
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])
}

model Advertisement {
  id        String   @id @default(cuid())
  title     String
  type      String
  content   String
  location  String
  duration  Int      @default(5)
  viewCount Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}
